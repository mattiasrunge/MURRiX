<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>MURRiX</title>
    <link id="favicon" rel="shortcut icon" href="img/favicon.png" type="image/png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="robots" content="noarchive, nosnippet, notranslate">

    <script src="/socket.io/socket.io.js"></script>

    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/imgareaselect-default.css" rel="stylesheet">
    <link href="css/bootstrap-theme/jquery-ui-1.8.16.custom.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">


  </head>

  <body>
    <div class="loading-overlay"></div>

    {{include:views/view.html}}
    {{include:views/node/view.html}}
    {{include:views/node/about/view.html}}
    {{include:views/node/files/view.html}}
    {{include:views/node/relations/view.html}}
    {{include:views/node/comments/view.html}}
    {{include:views/node/overlay/view.html}}
    {{include:views/node/timeline/view.html}}
    {{include:views/node/issues/view.html}}
    {{include:views/search/view.html}}
    {{include:views/admin/view.html}}
    {{include:views/config/view.html}}
    {{include:views/news/view.html}}
    {{include:views/browse/view.html}}
    {{include:views/tags/view.html}}
    {{include:views/organize/view.html}}
    {{include:views/help/view.html}}
    {{include:views/map/view.html}}

    {{include:views/dialog/components/select/view.html}}
    {{include:views/dialog/components/text/view.html}}
    {{include:views/dialog/components/position/view.html}}
    {{include:views/dialog/components/datetime/view.html}}
    {{include:views/dialog/components/nodelist/view.html}}

    {{include:views/dialog/example/view.html}}
    {{include:views/dialog/group/view.html}}
    {{include:views/dialog/user/view.html}}
    {{include:views/dialog/textItem/view.html}}
    {{include:views/dialog/vehicleNode/view.html}}
    {{include:views/dialog/cameraNode/view.html}}
    {{include:views/dialog/locationNode/view.html}}
    {{include:views/dialog/personNode/view.html}}
    {{include:views/dialog/albumNode/view.html}}
    {{include:views/dialog/upload/view.html}}


 <!-- Third-party script files -->
    <script src="http://code.jquery.com/jquery-1.9.0.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.0.0.js"></script>

<!--     <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script> -->
<!--     <script>window.jQuery || document.write('<script src="js/jquery-1.8.2.min.js"><\/script>')</script> -->

    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-ui-1.9.1.custom.min.js"><\/script>')</script>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>

    <script src="js/knockout-2.2.1.js"></script>
    <script src="js/knockout.mapping-latest.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.imgareaselect.min.js"></script>
    <script src="js/jquery.hotkeys.js"></script>


    <!-- MURRiX base library script files -->
    <script src="{{link:js/murrix.js}}"></script>
    <script src="{{link:js/knockout.extensions.js}}"></script>

    <script src="{{link:views/dialog/components/select/model.js}}"></script>
    <script src="{{link:views/dialog/components/text/model.js}}"></script>
    <script src="{{link:views/dialog/components/position/model.js}}"></script>
    <script src="{{link:views/dialog/components/datetime/model.js}}"></script>
    <script src="{{link:views/dialog/components/nodelist/model.js}}"></script>

    <script src="{{link:views/dialog/example/model.js}}"></script>
    <script src="{{link:views/dialog/group/model.js}}"></script>
    <script src="{{link:views/dialog/user/model.js}}"></script>
    <script src="{{link:views/dialog/vehicleNode/model.js}}"></script>
    <script src="{{link:views/dialog/cameraNode/model.js}}"></script>
    <script src="{{link:views/dialog/locationNode/model.js}}"></script>
    <script src="{{link:views/dialog/personNode/model.js}}"></script>
    <script src="{{link:views/dialog/albumNode/model.js}}"></script>
    <script src="{{link:views/dialog/textItem/model.js}}"></script>
    <script src="{{link:views/dialog/upload/model.js}}"></script>
    <script src="{{link:views/dialog/model.js}}"></script>


    <!-- MURRiX view script files -->
    <script src="{{link:views/node/about/model.js}}"></script>
    <script src="{{link:views/node/files/model.js}}"></script>
    <script src="{{link:views/node/relations/model.js}}"></script>
    <script src="{{link:views/node/comments/model.js}}"></script>
    <script src="{{link:views/node/overlay/model.js}}"></script>
    <script src="{{link:views/node/timeline/model.js}}"></script>
    <script src="{{link:views/node/issues/model.js}}"></script>
    <script src="{{link:views/node/model.js}}"></script>
    <script src="{{link:views/search/model.js}}"></script>
    <script src="{{link:views/admin/model.js}}"></script>
    <script src="{{link:views/config/model.js}}"></script>
    <script src="{{link:views/news/model.js}}"></script>
    <script src="{{link:views/browse/model.js}}"></script>
    <script src="{{link:views/tags/model.js}}"></script>
    <script src="{{link:views/organize/model.js}}"></script>
    <script src="{{link:views/help/model.js}}"></script>
    <script src="{{link:views/map/model.js}}"></script>
    <script src="{{link:views/model.js}}"></script>

    <!-- Initialization scripts and definitions -->
    <script>

      /* Connect to server and set up startup event handlers */
      murrix.server = io.connect();

      murrix.server.socket.on("error", function(reason)
      {
        console.error("Unable to connect Socket.IO, reason: " + reason);
      });

      murrix.server.on("connect", function()
      {
        console.info("Successfully established a working connection to server");
      });

      murrix.server.on("connection_established", function(data)
      {
        if (data.error)
        {
          console.log("Error while established connection to MURRiX, reason: " + data.error);
          return;
        }

        console.log("Successfully connected to MURRiX backend");

        murrix.model.setCurrentUserData(data.userData);

        function hashChangeHandler()
        {
          var state = "";

          if (document.location.hash.length > 0)
          {
            state = document.location.hash.slice(1);
          }

          /* HACK: Close open dropdowns */
          $(".dropdown.open .dropdown-toggle").dropdown("toggle");

          /* Update the current path of the base model */
          murrix.updatePath(state, murrix.model.path);
        }

        $(window).on("hashchange", hashChangeHandler);

        hashChangeHandler();

        // TODO: this code should be in the cache object, but server is not initalized yet, fix that somehow
        murrix.server.on("cacheJobDone", function(data)
        {
          murrix.cache.queuedImageDone(data.error, data.id);
        });
      });


      $(function()
      {
        /* Apply bindings on base model */
        ko.applyBindings(murrix.model);


        /* HACK: Disable closing of popup in login form */
        $(".dropdown-menu input, .dropdown-menu label").click(function(e)
        {
          e.stopPropagation();
        });



        /* Clear loading overlay */
        $(".loading-overlay").fadeOut();
      });

    </script>
  </body>
</html>
