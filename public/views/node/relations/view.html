<script type="text/html" id="personRelationsTemplate">

  <table style="text-align: center;" class="relation-table">
    <tbody>
      <!-- ko if: $data.parents.length > 0 -->
        <tr class="relation-parent-row" data-bind="visible: $data.showParents">
          <td data-bind="foreach: $data.parents" style="white-space: nowrap; line-height: normal; padding: 0px; margin: 0px; padding-left: 15px; padding-right: 15px;"><div style="display: inline-block; vertical-align: bottom;" data-bind="template: { name: 'personRelationsTemplate', data: $data }"></div></td>
        </tr>
      <!-- /ko -->
      <tr>
        <td style="line-height: normal; padding: 0px;">
          <!-- ko if: $data.type === 'child' -->
            <div class="relation-horizontal-line-left" data-bind="css: { 'relation-horizontal-line-hide': $data.first }"></div><!--
            --><div class="relation-horizontal-line-right" data-bind="css: { 'relation-horizontal-line-hide': $data.last }"></div>
          <!-- /ko -->

          <!-- ko if: $data.parents.length > 0 || $data.type === 'child' -->
            <div style="height: 40px; width: 2px; background-color: white; margin-left: auto; margin-right: auto; margin-top: -5px; overflow: visible;">
              <button data-bind="visible: $data.type !== 'child', click: nodeModel.relationsModel.expandParentsClicked" class="relation-expand relation-parent-expand">
                <i data-bind="visible: !$data.showParents()" class="icon-plus"></i>
                <i data-bind="visible: $data.showParents()" class="icon-minus"></i>
              </button>

              <!--<button data-bind="visible: $data.type === 'parent', click: nodeModel.relationsModel.expandChildrenClicked" class="btn btn-primary relation-add relation-child-add">
                <i class="icon-plus"></i>
              </button>-->

              <!--<button data-bind="visible: $data.type === 'child', click: nodeModel.relationsModel.expandChildrenClicked" class="btn btn-danger relation-cut relation-child-cut">
                <i class="icon-remove"></i>
              </button>-->

            </div>
          <!-- /ko -->

          <div data-bind="css: { 'relation-me': $data.type === 'me' }" style="display: inline-block; position: relative;">

            <div data-bind="style: { zoom: nodeModel.relationsModel.zoom }" style="vertical-align: top; margin-left: auto; margin-right: auto; width: 320px; height: 92px;">

              <div class="box-content relation-person-box" style="margin: 0px 15px 0px 15px; height: 90px; padding: 0px; position: relative;" data-bind="visible: nodeModel.relationsModel.zoom() <= 0.7">

                <div class="relation-person-image-small">
                  <img data-bind="srcPicture: [ $data.profilePicture ? $data.profilePicture._id : false, 80, 80, 1, $data.profilePicture ? $data.profilePicture.cacheId : false, false ], attr: { title: $data.name }">
                </div>

                <div class="box relation-person-image-small-title" data-bind="css: { 'relation-person-title-male': $data.gender === 'm', 'relation-person-title-female': $data.gender === 'f' }">
                  <a src="#" data-bind="click: nodeModel.relationsModel.personClickHandler">
                    <span data-bind="text: $data.name"></span>
                  </a>
                </div>
              </div>

              <div class="box box-content relation-person-box" style="margin: 0px 15px 0px 15px; height: 90px; padding: 0px; position: relative;" data-bind="visible: nodeModel.relationsModel.zoom() > 0.7">

                <div class="relation-person-image">
                  <img data-bind="srcPicture: [ $data.profilePicture ? $data.profilePicture._id : false, 80, 80, 1, $data.profilePicture ? $data.profilePicture.cacheId : false, false ]">
                </div>

                <div class="relation-person-title">
                  <a class="dropdown-toggle pull-right hide" data-toggle="dropdown" href="#">
                    <i data-bind="visible: $data.type === 'parent' || $data.type === 'me'" class="icon-plus icon-white" title="Add parent"></i>
                    <i data-bind="visible: $data.type === 'child' || $data.type === 'me'" class="icon-plus icon-white" title="Add child"></i>
                  </a>

                  <div class="relation-person-title-background" data-bind="css: { 'relation-person-title-male': $data.gender === 'm', 'relation-person-title-female': $data.gender === 'f' }"></div>
                  <a src="#" data-bind="click: nodeModel.relationsModel.personClickHandler">
                    <i class="icon-user"></i>
                    <span data-bind="text: $data.name"></span>
                  </a>
                </div>

                <div style="padding-left: 90px;">
                  <div data-bind="visible: $data.birth || $data.death" style="margin-bottom: 10px;">
                    <i class="icon-calendar"></i>
                    <span class="relation-person-birth" data-bind="visible: $data.birth, text: $data.birth"></span>
                    <span class="relation-person-death" data-bind="visible: $data.death">&mdash; <span data-bind="text: $data.death"></span></span>
                  </div>
                  <div data-bind="if: $data.partner">
                    <i class="icon-heart"></i>
                    <a class="relation-person-partner" data-bind="text: $data.partner.name, click: nodeModel.relationsModel.personPartnerClickHandler">Abc</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ko if: $data.children.length > 0 || $data.type === 'parent' -->
            <div style="height: 40px; width: 2px; background-color: white; margin-left: auto; margin-right: auto; margin-bottom: -13px; overflow: visible;">
              <button data-bind="visible: $data.type !== 'parent', click: nodeModel.relationsModel.expandChildrenClicked" class="relation-expand relation-child-expand">
                <i data-bind="visible: !$data.showChildren()" class="icon-plus"></i>
                <i data-bind="visible: $data.showChildren()" class="icon-minus"></i>
              </button>

               <!--<button data-bind="visible: $data.type === 'parent', click: nodeModel.relationsModel.expandChildrenClicked" class="btn btn-danger relation-cut relation-parent-cut">
                <i class="icon-remove"></i>
              </button>-->

               <!--<button data-bind="visible: $data.type === 'child', click: nodeModel.relationsModel.expandChildrenClicked" class="btn btn-primary relation-add relation-parent-add">
                 <i class="icon-plus"></i>
               </button>-->
            </div>
          <!-- /ko -->

          <!-- ko if: $data.type === 'parent' -->
            <div class="relation-horizontal-line-left" data-bind="css: { 'relation-horizontal-line-hide': $data.first }"></div><!--
            --><div class="relation-horizontal-line-right" data-bind="css: { 'relation-horizontal-line-hide': $data.last }"></div>
          <!-- /ko -->
        </td>
      </tr>
      <!-- ko if: $data.children.length > 0 -->
        <tr class="relation-child-row" data-bind="visible: $data.showChildren">
          <td data-bind="foreach: $data.children" style="white-space: nowrap; line-height: normal; padding: 0px; margin: 0px; padding-left: 15px; padding-right: 15px;"><div style="display: inline-block; vertical-align: top;" data-bind="template: { name: 'personRelationsTemplate', data: $data }"></div></td>
        </tr>
      <!-- /ko -->
    </tbody>
  </table>
</script>

<div data-bind="fadeVisible: nodeModel.relationsModel.show">
  <div class="abs-max content" data-bind="if: nodeModel.node() !== false">

    <div class="relation-container" data-bind="event: { mousedown: nodeModel.relationsModel.startDragHandler, mousemove: nodeModel.relationsModel.dragHandler, mouseup: nodeModel.relationsModel.stopDragHandler, mousewheel: nodeModel.relationsModel.scrollHandler, DOMMouseScroll: nodeModel.relationsModel.scrollHandler }">

      <div class="relation-zoom-control">
        <div class="line"></div>
        <div class="inc" data-bind="click: nodeModel.relationsModel.zoomInc">
          <div style="margin-left: 5px;"><i class="icon-plus"></i></div>
        </div>
        <div class="mark-container" data-bind="event: { mousedown: nodeModel.relationsModel.startDragMarkHandler }">
          <div class="mark">
            <div style="margin-left: 5px; margin-top: -4px;"><i class="icon-minus"></i></div>
          </div>
        </div>
        <div class="dec" data-bind="click: nodeModel.relationsModel.zoomDec">
          <div style="margin-left: 5px;"><i class="icon-minus"></i></div>
        </div>
      </div>

      <div id="relation-canvas" style="position: absolute; top: 0px; left: 0px;">
        <div data-bind="template: { name: 'personRelationsTemplate', data: nodeModel.relationsModel.tree, if: nodeModel.relationsModel.tree }"></div>
      </div>
    </div>

  </div>
  <div class="abs-max background"></div>
</div>
