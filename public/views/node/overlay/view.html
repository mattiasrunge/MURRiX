<script type="text/html" id="imageTemplate">
  <img class="" style="display: inline-block; height: auto; max-height: 100%; max-width: 100%; vertical-align: middle; width: auto;" data-bind="srcPicture: [ $data._id, 1400, 0, 0, $data.cacheId ]" src="" alt="">
</script>


<div data-bind="fadeVisible: nodeModel.overlayModel.show">
  <div style="position: fixed; top: 0px; left: 0px; bottom: 0px; width: 75px; z-index: 2060;" data-bind="fadeVisible: !nodeModel.overlayModel.autoplay()">
    <a style="font-size: 100px; width: 100%; padding: 0px; margin-top: auto; margin-bottom: auto; height: 100px;" class="carousel-control left" href="#" data-bind="click: nodeModel.overlayModel.previous, clickKey: 'left'">&lsaquo;</a>
  </div>
  <div style="position: fixed; top: 0px; bottom: 0px; right: 350px; width: 75px; z-index: 2060;" data-bind="fadeVisible: !nodeModel.overlayModel.autoplay()">
    <a style="font-size: 100px; width: 100%; padding: 0px; margin-top: auto; margin-bottom: auto; height: 100px;" class="carousel-control right" href="#" data-bind="click: nodeModel.overlayModel.next, clickKey: 'right'">&rsaquo;</a>
  </div>
</div>


<div style="background-color: white; position: fixed; top: 0px; left: 0px; bottom: 0px; right: 0px; z-index: 1040;" data-bind="fadeVisible: nodeModel.overlayModel.show"></div>
<div style="position: fixed; top: 0px; left: 0px; bottom: 0px; right: 0px; text-align: center; background-color: black;"></div>

<div style="position: absolute; top: 0px; left: 0px; right: 0px; z-index: 2050; background-color: black;" data-bind="fadeVisible: nodeModel.overlayModel.show">
  <!-- ko if: nodeModel.overlayModel.item() !== false -->

    <div style="position: fixed; top: 0px; left: 0px; bottom: 0px; right: 350px; text-align: center; background-color: black;" data-bind="if: nodeModel.overlayModel.item().what() === 'file', style: { right: nodeModel.overlayModel.autoplay() ? '0px' : '350px' }">



        <div class="imgContainer" style="position: relative; display: inline-block;">
          <div data-bind="if: nodeModel.overlayModel.item().whatDetailed() === 'imageFile'">
            <div data-bind="template: { name: 'imageTemplate', data: nodeModel.overlayModel.item() }"></div>
          </div>

          <div data-bind="if: nodeModel.overlayModel.item().whatDetailed() === 'videoFile'">
            <video class="overlayVideo" style="display: inline-block; height: auto; max-height: 100%; max-width: 100%; vertical-align: middle; width: auto;" preload="metadata" controls="true" data-bind="attr: { src: nodeModel.overlayModel.videoFile }, posterVideo: [ nodeModel.overlayModel.item()._id, nodeModel.overlayModel.item().angle() === 90 || nodeModel.overlayModel.item().angle() === 270 ? nodeModel.overlayModel.item().exif.ImageHeight : nodeModel.overlayModel.item().exif.ImageWidth, nodeModel.overlayModel.item().angle() === 90 || nodeModel.overlayModel.item().angle() === 270 ? nodeModel.overlayModel.item().exif.ImageWidth : nodeModel.overlayModel.item().exif.ImageHeight, nodeModel.overlayModel.item().cacheId ]" src="" alt=""></video>
          </div>
        </div>

        <div data-bind="if: nodeModel.overlayModel.item().whatDetailed() === 'audioFile'">
          <div style="padding: 20px 100px 20px 100px; color: white">
            <h3 style="text-align: center;" data-bind="text: nodeModel.overlayModel.item().name"></h3>
            <video style="display: inline-block; width: 720px; height: 288px; vertical-align: middle;" preload="metadata" controls="true" data-bind="attr: { src: nodeModel.overlayModel.videoFile }, posterVideo: [ nodeModel.overlayModel.item()._id, 720, 288 ]" src="" alt=""></video>
          </div>
        </div>
    </div>

    <div style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 350px; text-align: center;" data-bind="if: nodeModel.overlayModel.item().what() === 'text', style: { right: nodeModel.overlayModel.autoplay() ? '0px' : '350px' }">
      <div style="padding: 20px 100px 20px 100px; text-align: left; color: white">
        <h3 style="text-align: center;" data-bind="text: nodeModel.overlayModel.item().name"></h3>
        <p data-bind="html: nodeModel.overlayModel.item().text().replace(/\n/g, '<br>')"></p>
      </div>
    </div>
  <!-- /ko -->
</div>

<div style="position: absolute; top: 0px; width: 350px; right: 0px; z-index: 2070; background-color: black;" data-bind="fadeVisible: nodeModel.overlayModel.show() && !nodeModel.overlayModel.autoplay()">
  <!-- ko if: nodeModel.overlayModel.item() !== false -->

    <div style="position: absolute; top: 0px; width: 350px; right: 0px; margin: 0px; padding: 0px; background-color: white;">
      <div style="padding: 10px;" data-bind="visible: nodeModel.overlayModel.editType() === 'showing'">
        <a class="pull-right close" data-bind="click: nodeModel.overlayModel.editFinishClicked" style="font-size: 30px">×</a>

        <h3 class="page-header" style="margin-top: 10px;">Tags</h3>
        <p class="text-muted" style="font-size: 12px;">
          <i>Tag people or things on this item e.g. who is visible on this picture.</i>
        </p>

        <div class="form-group">
          <div class="btn-group">
            <button class="btn btn-default btn-xs" data-bind="click: nodeModel.overlayModel.showingCreatePerson">Create person</button>
            <button class="btn btn-default btn-xs" data-bind="click: nodeModel.overlayModel.showingCreateVehicle">Create vehicle</button>
            <button class="btn btn-default btn-xs" data-bind="click: nodeModel.overlayModel.showingCreateCamera">Create camera</button>
          </div>
        </div>

        <div class="form-group">
          <div data-bind="template: { name: nodeModel.overlayModel.showingModel.template(), data: nodeModel.overlayModel.showingModel }"></div>
        </div>
      </div>

      <div style="padding: 10px;" data-bind="visible: nodeModel.overlayModel.editType() === 'who'">
        <a class="pull-right close" data-bind="click: nodeModel.overlayModel.editFinishClicked" style="font-size: 30px">×</a>

        <h3 class="page-header" style="margin-top: 10px;">Select a person</h3>
        <p class="text-muted" style="font-size: 12px;">
          <i>Select the person who created this item e.g. who took this picture.</i>
        </p>

        <div class="form-group">
          <button class="btn btn-default btn-small" style="width: 100%;" data-bind="click: nodeModel.overlayModel.whoCreatePerson">Create new person</button>
        </div>

        <div class="form-group">
          <div data-bind="template: { name: nodeModel.overlayModel.whoModel.template(), data: nodeModel.overlayModel.whoModel }"></div>
        </div>
      </div>

      <div style="padding: 10px;" data-bind="visible: nodeModel.overlayModel.editType() === 'with'">
        <a class="pull-right close" data-bind="click: nodeModel.overlayModel.editFinishClicked" style="font-size: 30px">×</a>

        <h3 class="page-header" style="margin-top: 10px;">Select camera</h3>
        <p class="text-muted" style="font-size: 12px;">
          <i>Select which camera this item was created with e.g. what camera was used to take this picture.</i>
        </p>

        <div class="form-group">
          <button class="btn btn-default btn-small" style="width: 100%;" data-bind="click: nodeModel.overlayModel.withCreateFromExif">Create new camera</button>
        </div>

        <div class="form-group">
          <div data-bind="template: { name: nodeModel.overlayModel.withModel.template(), data: nodeModel.overlayModel.withModel }"></div>
        </div>

        <div data-bind="if: nodeModel.overlayModel.item().exif">
          <h5>File information</h5>

          <table class="table table-condensed table-striped" style="font-size: 12px;">
            <tbody>
              <tr data-bind="visible: nodeModel.overlayModel.item().exif.Make">
                <td>
                  Camera make
                </td>
                <td data-bind="text: nodeModel.overlayModel.item().exif.Make"></td>
              </tr>
              <tr data-bind="visible: nodeModel.overlayModel.item().exif.Model">
                <td>
                  Camera model
                </td>
                <td data-bind="text: nodeModel.overlayModel.item().exif.Model"></td>
              </tr>
              <tr data-bind="visible: nodeModel.overlayModel.item().exif.SerialNumber">
                <td>
                  Camera serial number
                </td>
                <td data-bind="text: nodeModel.overlayModel.item().exif.SerialNumber"></td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>





      <div style="padding: 10px;" data-bind="visible: nodeModel.overlayModel.editType() === 'when'">
        <a class="pull-right close" data-bind="click: nodeModel.overlayModel.editFinishClicked" style="font-size: 30px">×</a>

        <h3 class="page-header" style="margin-top: 10px;">Set date and time</h3>
        <div class="alert alert-error" data-bind="visible: nodeModel.overlayModel.editErrorText() != '', text: nodeModel.overlayModel.editErrorText"></div>
        <p class="text-muted" style="font-size: 12px;">
          <i>Set date and time when item was created e.g. when was this picture taken. All times are stored in UTC, be sure that timezone and daylight savings information is correct.</i>
        </p>

        <div class="alert alert-error" data-bind="visible: nodeModel.overlayModel.item().with() === false && nodeModel.overlayModel.item().what() === 'file'">
          <strong>Warning!</strong> No camera selected for this file!
        </div>

        <div>
          <h5>Current date and time information</h5>
          <p class="text-muted" style="font-size: 12px;">
            <i>
              The current, if any, time and date information associated with this item is shown here. It can be updated by the forms below.
            </i>
          </p>
          <div class="alert alert-info">
            <span data-bind="htmlPrintWhen: { when: nodeModel.overlayModel.item().when, timezone: false, popover: true }"></span>
          </div>
        </div>

        <div>
          <h5>Edit date and time information</h5>
          <table class="table table-condensed" style="font-size: 10px; margin-bottom: 5px;">
            <tbody>
              <tr>
                <td>Source</td>
                <td>
                  <span data-bind="visible: nodeModel.overlayModel.whenType() === 'gps'">Gps</span>
                  <span data-bind="visible: nodeModel.overlayModel.whenType() === 'camera'">Camera</span>
                  <span data-bind="visible: nodeModel.overlayModel.whenType() === 'manual'">Manual</span>
                  <a data-bind="click: nodeModel.overlayModel.whenSetManual, visible: nodeModel.overlayModel.whenType() === 'gps' || nodeModel.overlayModel.whenType() === 'camera'" class="pull-right" style="cursor: pointer;">Enter manual</a>
                </td>
              </tr>
              <tr data-bind="visible: nodeModel.overlayModel.whenType() === 'manual'">
                <td>Comment</td>
                <td class="form-inline">
                  <input type="text" class="input-large" data-bind="value: nodeModel.overlayModel.whenComment">
                </td>
              </tr>
              <tr>
                <td>Date</td>
                <td class="form-inline">
                  <select class="input-small" data-bind="value: nodeModel.overlayModel.whenYear, foreach: yearList, disable: nodeModel.overlayModel.whenYearDisabled, event: { change: nodeModel.overlayModel.whenUpdatedValue }">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                  <strong>-</strong>
                  <select class="input-mini" data-bind="value: nodeModel.overlayModel.whenMonth, foreach: monthList, disable: nodeModel.overlayModel.whenMonthDisabled() || nodeModel.overlayModel.whenYear() === 'XXXX', event: { change: nodeModel.overlayModel.whenUpdatedValue }">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                  <strong>-</strong>
                  <select class="input-mini" data-bind="value: nodeModel.overlayModel.whenDay, foreach: dayList, disable: nodeModel.overlayModel.whenDayDisabled() || nodeModel.overlayModel.whenMonth() === 'XX', event: { change: nodeModel.overlayModel.whenUpdatedValue }">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                </td>
              </tr>
              <tr>
                <td>Time</td>
                <td class="form-inline">
                  <select class="input-mini" data-bind="value: nodeModel.overlayModel.whenHour, foreach: hourList, disable: nodeModel.overlayModel.whenHourDisabled() || nodeModel.overlayModel.whenDay() === 'XX'">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                  <strong>:</strong>
                  <select class="input-mini" data-bind="value: nodeModel.overlayModel.whenMinute, foreach: minuteList, disable: nodeModel.overlayModel.whenMinuteDisabled() || nodeModel.overlayModel.whenHour() === 'XX'">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                  <strong>:</strong>
                  <select class="input-mini" data-bind="value: nodeModel.overlayModel.whenSecond, foreach: secondList, disable: nodeModel.overlayModel.whenSecondDisabled() || nodeModel.overlayModel.whenMinute() === 'XX'">
                    <option data-bind="attr: { value: $data.value }, text: $data.name"></option>
                  </select>
                </td>
              </tr>
              <tr data-bind="visible: nodeModel.overlayModel.whenType() === 'camera' && nodeModel.overlayModel.item().with() !== false && nodeModel.overlayModel.item().with().mode() !== 'autoDatetime' && nodeModel.overlayModel.item().what() === 'file'">
                <td>
                  Reference
                </td>
                <td class="form-inline">
                  <select data-bind="value: nodeModel.overlayModel.whenReference, disable: nodeModel.overlayModel.whenReferenceDisabled, options: nodeModel.overlayModel.whenReferences, optionsText: 'name', optionsValue: 'id', event: { change: nodeModel.overlayModel.whenUpdatedValue }" style="width: 100%"></select>
                <td>
              </tr>
              <tr data-bind="visible: nodeModel.overlayModel.whenManualTimezoneAllowed">
                <td>Timezone</td>
                <td class="form-inline">
                  <select data-bind="options: timezones, value: nodeModel.overlayModel.whenTimezone, disable: nodeModel.overlayModel.whenTimezoneDisabled() || nodeModel.overlayModel.whenHour() === 'XX'" style="width: 100%"></select>
                  <label class="checkbox" style="margin-top: 2px; font-size: 10px;" data-bind="visible: nodeModel.overlayModel.whenManualDaylightSavingsAllowed">
                    <input type="checkbox" data-bind="checked: nodeModel.overlayModel.whenDaylightSavings, disable: nodeModel.overlayModel.whenDaylightSavingsDisabled() || nodeModel.overlayModel.whenHour() === 'XX'"> Daylight savings in affect
                  </label>
                </td>
              </tr>
              <tr>
                <td></td>
                <td>
                  <button class="btn btn-primary btn-mini" type="button" style="width: 100%;" data-bind="click: nodeModel.overlayModel.whenSave">Save</button>
                </td>
              </tr>
            </tbody>
          </table>

        </div>

        <div data-bind="if: nodeModel.overlayModel.item().exif && (nodeModel.overlayModel.item().exif.GPSDateTime || nodeModel.overlayModel.item().exif.DateTimeOriginal)">
          <h5>File information</h5>
          <p class="text-muted" style="font-size: 12px;">
            <i>This file has time metadata stored in it, all available information is listed here and can be used if needed.</i>
          </p>
          <table class="table table-condensed" style="font-size: 10px; margin-bottom: 20px;">
            <tbody>
              <tr data-bind="if: nodeModel.overlayModel.item().exif.GPSDateTime">
                <td>
                  GPS
                </td>
                <td data-bind="text: nodeModel.overlayModel.item().exif.GPSDateTime()"></td>
                <td>
                  <a data-bind="disable: nodeModel.overlayModel.editLoading, click: nodeModel.overlayModel.whenSetExifGps" style="cursor: pointer;" class="pull-right">Set</a>
                </td>
              </tr>
              <tr data-bind="if: nodeModel.overlayModel.item().exif.DateTimeOriginal">
                <td>
                  Camera
                </td>
                <td data-bind="text: nodeModel.overlayModel.item().exif.DateTimeOriginal()"></td>
                <td>
                  <a data-bind="disable: nodeModel.overlayModel.editLoading, click: nodeModel.overlayModel.whenSetExifCamera" style="cursor: pointer;" class="pull-right">Set</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div data-bind="visible: nodeModel.overlayModel.whenReferenceVisible() && (nodeModel.overlayModel.whenReferenceSelf() !== false || nodeModel.overlayModel.whenReferenceCreateAllowed())">
          <h5>Reference timelines for <span data-bind="text: nodeModel.overlayModel.item().with().name"></span></h5>
          <p class="text-muted" style="font-size: 12px;">
            <i>
              Reference timelines can be created for a camera to adjust the date and time for each file created with that camera. The internal clock of the camera might be inaccurate and needs to be synchronized to a good quality time source.
            </i>
          </p>
          <p class="text-muted" style="font-size: 12px;">
            <i>
              This file has time information (Gps or Manual), in addition to the camera information, which can be used as a reference timeline if one is created.
            </i>
          </p>
          <table class="table table-condensed" data-bind="visible: nodeModel.overlayModel.whenReferenceSelf() !== false">
            <thead>
              <th>Name</th>
              <th>Offset</th>
              <th>Type</th>
              <th></th>
            </thead>
            <tbody>
              <tr>
                <td data-bind="text: nodeModel.overlayModel.whenReferenceSelf().name"></td>
                <td data-bind="text: nodeModel.overlayModel.whenReferenceSelf().offset"></td>
                <td data-bind="text: nodeModel.overlayModel.whenReferenceSelf().type"></td>
                <td><button class="btn" data-bind="click: nodeModel.overlayModel.whenRemoveReference"><i class="icon icon-trash"></i></button>
              </tr>
            </tbody>
          </table>
          <button class="btn btn-primary btn-mini" type="button" style="width: 100%;" data-bind="visible: nodeModel.overlayModel.whenReferenceCreateAllowed, click: nodeModel.overlayModel.whenCreateReference">Create reference</button>
        </div>

      </div>




      <div style="padding: 10px;" data-bind="visible: nodeModel.overlayModel.editType() === 'where'">
        <a class="pull-right close" data-bind="click: nodeModel.overlayModel.editFinishClicked" style="font-size: 30px">×</a>

        <h3 class="page-header" style="margin-top: 10px;">Select a position/location</h3>
        <p class="text-muted" style="font-size: 12px;">
          <i>Select a position or location where this item was created e.g. where this picture was taken. Setting a position is the preferred way since it is more accurate, but a location can be selected directly if the exact position is uncertain.</i>
        </p>

        <ul class="nav nav-tabs" style="font-size: 10px; margin-bottom: 10px;" data-bind="visible: !nodeModel.overlayModel.whereHidePosition() && !nodeModel.overlayModel.whereHideLocation()">
          <li class="active"><a href="#overlayTabWherePosition" data-toggle="tab">Position</a></li>
          <li><a href="#overlayTabWhereLocation" data-toggle="tab">Location</a></li>
        </ul>

        <div class="tab-content">
          <div class="active" id="overlayTabWherePosition" data-bind="visible: !nodeModel.overlayModel.whereHidePosition(), css: { 'tab-pane': !nodeModel.overlayModel.whereHidePosition() && !nodeModel.overlayModel.whereHideLocation() }">
            <div data-bind="template: { name: nodeModel.overlayModel.wherePositionModel.template(), data: nodeModel.overlayModel.wherePositionModel }"></div>

            <div data-bind="if: nodeModel.overlayModel.item().exif && nodeModel.overlayModel.item().exif.GPSLatitude">
              <h5>
                File information
                <button title="Set" style="margin-top: 7px;" data-bind="disable: nodeModel.overlayModel.editLoading, click: nodeModel.overlayModel.whereFileSet" class="btn btn-mini btn-link pull-right">Set file position</button>
              </h5>
              <table class="table table-condensed table-striped" style="font-size: 12px;">
                <tbody>
                  <tr>
                    <td>
                      Latitude
                    </td>
                    <td data-bind="text: nodeModel.overlayModel.item().exif.GPSLatitude"></td>
                  </tr>
                  <tr>
                    <td>
                      Longitude
                    </td>
                    <td data-bind="text: nodeModel.overlayModel.item().exif.GPSLongitude"></td>
                  </tr>
                </tbody>
              </table>
            </div>

          </div>
          <div class="" id="overlayTabWhereLocation" data-bind="visible: !nodeModel.overlayModel.whereHideLocation(), css: { 'tab-pane': !nodeModel.overlayModel.whereHidePosition() && !nodeModel.overlayModel.whereHideLocation() }">
            <div class="form-group">
              <button class="btn btn-default btn-small" style="width: 100%;" data-bind="click: nodeModel.overlayModel.whereCreateLocation">Create new location</button>
            </div>

            <div class="form-group">
              <div data-bind="template: { name: nodeModel.overlayModel.whereLocationModel.template(), data: nodeModel.overlayModel.whereLocationModel }"></div>
            </div>
          </div>
        </div>

      </div>

      <div data-bind="visible: nodeModel.overlayModel.editType() === '', if: nodeModel.node() !== false">
        <div style="padding: 10px; padding-bottom: 0px;">
          <a class="pull-right close" data-bind="hrefSecondSecondary: '', clickKey: 'esc'" style="font-size: 30px">×</a>

          <h4 style="white-space: nowrap; width: 305px; overflow: hidden; text-overflow: ellipsis; margin-bottom: 0px;" data-bind="text: nodeModel.node().name"></h4>

          <div class="text-muted" style="font-size: 10px; margin-bottom: 10px; margin-left: 5px;">
            &ndash; <i>Showing item <span data-bind="text: nodeModel.overlayModel.index"></span> of <span data-bind="text: nodeModel.overlayModel.count"></span></i>
            <i style="margin-left: 5px; cursor: pointer" title="Autoplay items" class="icon-play" data-bind="visible: !nodeModel.overlayModel.autoplay(), click: nodeModel.overlayModel.play"></i>
            <i style="margin-left: 5px; cursor: pointer" title="Pause autoplay" class="icon-pause" data-bind="visible: nodeModel.overlayModel.autoplay(), click: nodeModel.overlayModel.pause"></i>
          </div>

          <p style="font-size: 10px;" data-bind="text: nodeModel.overlayModel.item().description"></p>
        </div>

        <div style="font-size: 10px; padding: 10px; padding-top: 0px; text-align: left;">
          <table class="table table-striped table-condensed">
            <tr data-bind="visible: !nodeModel.overlayModel.item().type || nodeModel.overlayModel.item().type() === 'none'">
              <td>
                <a href="#" data-bind="visible: nodeModel.node().hasAdminAccess(), click: nodeModel.overlayModel.whoEditClicked">Created&nbsp;by</a>
                <span data-bind="visible: !nodeModel.node().hasAdminAccess()">Created&nbsp;by</span>
              </td>
              <td>
                <span data-bind="if: nodeModel.overlayModel.item().who() !== false">
                  <a href="#" data-bind="hrefFirst: [ 'node', nodeModel.overlayModel.item().who()._id ], popoverNode: nodeModel.overlayModel.item().who()._id, text: nodeModel.overlayModel.item().who().name"></a>
                </span>
                <span data-bind="visible: nodeModel.overlayModel.item().who() === false">
                  <div class="text-muted" data-bind="visible: nodeModel.node().hasAdminAccess()">
                    <div data-bind="foreach: nodeModel.overlayModel.whoModel.suggestionsNodes">
                      <a style="display: block;" href="#" data-bind="disable: $parent.nodeModel.overlayModel.editLoading, click: $parent.nodeModel.overlayModel.whoModel.addHandler">
                        Did <span data-bind="text: $data.name"></span> create this item?
                      </a>
                    </div>
                    <a style="display: block;" href="#" data-bind="click: nodeModel.overlayModel.whoEditClicked">
                      Select who created this item.
                    </a>
                  </div>
                </span>
              </td>
            </tr>
            <tr>
              <td>
                <a href="#" data-bind="visible: nodeModel.node().hasAdminAccess(), click: nodeModel.overlayModel.whereEditClicked">Location</a>
                <span data-bind="visible: !nodeModel.node().hasAdminAccess()">Location</span>
              </td>
              <td>
                <span data-bind="if: nodeModel.overlayModel.item().whereNode() !== false">
                  <a href="#" data-bind="hrefFirst: [ 'node', nodeModel.overlayModel.item().whereNode()._id ], popoverNode: nodeModel.overlayModel.item().whereNode()._id, text: nodeModel.overlayModel.item().whereNode().name"></a>
                </span>
                <span data-bind="if: nodeModel.overlayModel.item().whereString() !== false && nodeModel.overlayModel.item().whereNode() === false">
                  <span data-bind="text: nodeModel.overlayModel.item().whereString"></span>
                </span>
                <span data-bind="visible: nodeModel.overlayModel.item().whereNode() === false && nodeModel.overlayModel.item().whereString() === false">
                  <div class="text-muted" data-bind="visible: nodeModel.node().hasAdminAccess()">
                    <div data-bind="foreach: nodeModel.overlayModel.whereLocationModel.suggestionsNodes">
                      <a style="display: block;" href="#" data-bind="disable: $parent.nodeModel.overlayModel.editLoading, click: $parent.nodeModel.overlayModel.whereLocationModel.addHandler">
                        Was this item created at <span data-bind="text: $data.name"></span>?
                      </a>
                    </div>
                    <a style="display: block;" href="#" data-bind="click: nodeModel.overlayModel.whereEditClicked">
                      Select where this item was created.
                    </a>
                  </div>
                </span>
              </td>
            </tr>
            <tr data-bind="visible: nodeModel.overlayModel.item().what() === 'file'">
              <td>
                <a href="#" data-bind="visible: nodeModel.node().hasAdminAccess(), click: nodeModel.overlayModel.withEditClicked">Camera</a>
                <span data-bind="visible: !nodeModel.node().hasAdminAccess()">Camera</span>
              </td>
              <td>
                <span data-bind="if: nodeModel.overlayModel.item().with() !== false">
                  <a href="#" data-bind="hrefFirst: [ 'node', nodeModel.overlayModel.item().with()._id ], popoverNode: nodeModel.overlayModel.item().with()._id, text: nodeModel.overlayModel.item().with().name"></a>
                </span>
                <span data-bind="visible: nodeModel.overlayModel.item().with() === false">
                  <div class="text-muted" data-bind="visible: nodeModel.node().hasAdminAccess()">
                    <div data-bind="foreach: nodeModel.overlayModel.withModel.suggestionsNodes">
                      <a style="display: block;" href="#" data-bind="disable: $parent.nodeModel.overlayModel.editLoading, click: $parent.nodeModel.overlayModel.withModel.addHandler">
                        Was <span data-bind="text: $data.name"></span> used to create this item?
                      </a>
                    </div>
                    <a style="display: block;" href="#" data-bind="click: nodeModel.overlayModel.withEditClicked">
                      Select the camera used to create this item.
                    </a>
                  </div>
                </span>
              </td>
            </tr>
            <tr>
              <td>
                <a href="#" data-bind="visible: nodeModel.node().hasAdminAccess(), click: nodeModel.overlayModel.whenEditClicked">Date&nbsp;and&nbsp;Time</a>
                <span data-bind="visible: !nodeModel.node().hasAdminAccess()">Date&nbsp;and&nbsp;Time</span>
              </td>
              <td>
                <span data-bind="if: nodeModel.overlayModel.item().whenTimestamp() !== false">
                  <span data-bind="htmlPrintWhen: { when: nodeModel.overlayModel.item().when, timezone: false, popover: true }"></span>
                </span>
                <span data-bind="visible: nodeModel.overlayModel.item().whenTimestamp() === false && nodeModel.node().hasAdminAccess()">
                  <a style="display: block;" href="#" data-bind="click: nodeModel.overlayModel.whenEditClicked">
                    Select when this item was created.
                  </a>
                </span>
              </td>
            </tr>
            <tr>
              <td>
                <a href="#" data-bind="visible: nodeModel.node().hasAdminAccess(), click: nodeModel.overlayModel.showingEditClicked">Tags</a>
                <span data-bind="visible: !nodeModel.node().hasAdminAccess()">Tags</span>
              </td>
              <td>
                <span data-bind="visible: (!nodeModel.overlayModel.item().showing || nodeModel.overlayModel.item().showing().length === 0)  && nodeModel.node().hasAdminAccess()">
                  <a href="#" data-bind="click: nodeModel.overlayModel.showingEditClicked">
                    Tag something or someone.
                  </a>
                </span>
                <span data-bind="if: nodeModel.overlayModel.item().showing && nodeModel.overlayModel.item().showing().length > 0">
                  <span data-bind="foreach: nodeModel.overlayModel.item().showing">
                    <a style="position: relative;" href="#" data-bind="hrefFirst: [ 'node', $data._id ], popoverNode: $data._id, textNodeAttribute: [ $data._id, 'name' ], event: { mouseover: nodeModel.overlayModel.showingItemOver, mouseout: nodeModel.overlayModel.showingItemOut }"></a><!--
                 --><span data-bind="if: $index() + 2 === $parent.nodeModel.overlayModel.item().showing().length"> and</span><!--
                 --><span data-bind="if: $index() + 2 < $parent.nodeModel.overlayModel.item().showing().length">, </span><!--
               --></span>.
                </span>
              </td>
            </tr>
            <tr>
              <td>Belongs&nbsp;to</td>
              <td>
                <span data-bind="foreach: nodeModel.overlayModel.item()._parents">
                  <a href="#" data-bind="hrefFirst: [ 'node', $data ], textNodeAttribute: [ $data, 'name' ], popoverNode: $data"></a><!--
                  --><span data-bind="if: $index() + 2 === $parent.nodeModel.overlayModel.item()._parents().length"> and</span><!--
                --><span data-bind="if: $index() + 2 < $parent.nodeModel.overlayModel.item()._parents().length">, </span><!--
                --></span>.
              </td>
            </tr>
          </table>
        </div>

        <ul class="nav nav-tabs" style="font-size: 10px; margin-bottom: 10px; margin-left: 10px; margin-right: 10px;">
          <li class="active">
            <a href="#overlayTabComments" data-toggle="tab">Comments<span data-bind="visible: nodeModel.overlayModel.item().comments().length > 0"> (<span data-bind="text: nodeModel.overlayModel.item().comments().length"></span>)</span></a>
          </li>
          <li>
            <a href="#overlayTabDetails" data-toggle="tab">Details</a>
          </li>
          <li data-bind="visible: nodeModel.node().hasAdminAccess()">
            <a href="#overlayTabEdit" data-toggle="tab">Edit</a>
          </li>
          <li data-bind="visible: nodeModel.overlayModel.item().what() === 'file'">
            <a href="#overlayTabDownload" data-toggle="tab">Download</a>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane active" id="overlayTabComments">

            <div style="margin: 0px 10px 10px 10px; font-size: 10px; border-bottom: 1px solid #DDDDDD;">
              <div class="media">
                <img class="pull-left media-object imgRounded" style="width: 80px; height: 80px;" data-bind="srcUserProfilePicture: [ currentUser() !== false ? currentUser()._id() : false, 80, 80, 1 ]">
                <div class="media-body">
                  <blockquote class="form-group" style="padding: 0px; padding-left: 10px;">
                    <textarea style="height: 80px;" class="form-control" placeholder="Write a comment..." data-bind="disable: nodeModel.overlayModel.commentLoading, value: nodeModel.overlayModel.commentText"></textarea>
                  </blockquote>
                </div>
              </div>
              <div class="form-group">
                <button style="width: 100%" type="submit" class="btn btn-primary btn-xs" data-bind="click: nodeModel.overlayModel.commentSubmit">Comment</button>
              </div>
              <span class="text-danger" style="margin-top: 10px;" data-bind="visible: nodeModel.overlayModel.commentErrorText() !== '', text: nodeModel.overlayModel.commentErrorText"></span>
            </div>

            <!-- ko foreach: nodeModel.overlayModel.item().comments -->
              <div style="margin: 0px 10px 0px 10px; font-size: 10px;">
                <div class="media">
                  <img class="pull-left media-object imgRounded" style="width: 80px; height: 80px;" data-bind="srcUserProfilePicture: [ $data.added._by(), 80, 80, 1 ]">
                  <div class="media-body">
                    <blockquote style="min-height: 80px;">
                      <div style="padding-bottom: 5px;" data-bind="html: $data.text().replace(/\n/g, '<br>')"></div>
                      <small style="font-size: 10px;"><span data-bind="htmlTimeAgo: $data.added.timestamp"></span> by <span data-bind="textUserAttribute: [ $data.added._by(), 'name' ]"></span></small>
                    </blockquote>
                  </div>
                </div>
              </div>
            <!-- /ko -->

          </div>
          <div class="tab-pane" id="overlayTabDetails">

            <div style="margin: 0px 10px 10px 10px; font-size: 10px;">
              <table class="table table-striped table-condensed">
                  <tr>
                    <td>Name</td>
                    <td data-bind="text: nodeModel.overlayModel.item().name()"></td>
                  </tr>
                  <tr>
                    <td>Item&nbsp;added&nbsp;by</td>
                    <td data-bind="textUserAttribute: [ nodeModel.overlayModel.item().added._by(), 'name' ]"></td>
                  </tr>
                  <tr>
                    <td>Item&nbsp;added&nbsp;on</td>
                    <td data-bind="htmlTimestamp: nodeModel.overlayModel.item().added.timestamp"></td>
                  </tr>
                  <tr>
                    <td>Item&nbsp;modified&nbsp;by</td>
                    <td data-bind="textUserAttribute: [ nodeModel.overlayModel.item().modified._by(), 'name' ]"></td>
                  </tr>
                  <tr>
                    <td>Item&nbsp;modified&nbsp;on</td>
                    <td data-bind="htmlTimestamp: nodeModel.overlayModel.item().modified.timestamp"></td>
                  </tr>
                  <!-- ko if: nodeModel.overlayModel.item().exif -->
                    <tr>
                      <td>File&nbsp;size</td>
                      <td data-bind="htmlSize: nodeModel.overlayModel.item().exif.FileSize()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ImageWidth && nodeModel.overlayModel.item().exif.ImageHeight">
                      <td>Resolution</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.ImageWidth() + 'x' + nodeModel.overlayModel.item().exif.ImageHeight()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().type">
                      <td>Type</td>
                      <td data-bind="text: nodeModel.overlayModel.item().type()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.Make">
                      <td>Camera&nbsp;make</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.Make()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.Model">
                      <td>Camera&nbsp;model</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.Model()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.Orientation">
                      <td>Orientation</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.Orientation()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().angle">
                      <td>Angle</td>
                      <td data-bind="text: nodeModel.overlayModel.item().angle()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().mirror">
                      <td>Mirror</td>
                      <td data-bind="text: nodeModel.overlayModel.item().mirror()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.MIMEType">
                      <td>MIME&nbsp;type</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.MIMEType()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ISO">
                      <td>ISO</td>
                      <td data-bind="text: murrix.makeDecimalPretty(nodeModel.overlayModel.item().exif.ISO())"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.FocalLength">
                      <td>Focal&nbsp;length</td>
                      <td data-bind="text: murrix.makeDecimalPretty(nodeModel.overlayModel.item().exif.FocalLength())"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ShutterSpeedValue">
                      <td>Shutter&nbsp;speed&nbsp;value</td>
                      <td data-bind="text: murrix.makeDecimalPretty(nodeModel.overlayModel.item().exif.ShutterSpeedValue())"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ShutterSpeedValue">
                      <td>Aperture&nbsp;value</td>
                      <td data-bind="text: murrix.makeDecimalPretty(nodeModel.overlayModel.item().exif.ShutterSpeedValue())"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ResolutionUnit">
                      <td>Resolution&nbsp;unit</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.ResolutionUnit()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.Compression">
                      <td>Compression</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.Compression()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ColorSpace">
                      <td>Color&nbsp;space</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.ColorSpace()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ColorComponents">
                      <td>Color&nbsp;components</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.ColorComponents()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.BitsPerSample">
                      <td>Bits&nbsp;per&nbsp;sample</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.BitsPerSample()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.ComponentsConfiguration">
                      <td>Components&nbsp;configuration</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.ComponentsConfiguration()"></td>
                    </tr>
                    <tr data-bind="if: nodeModel.overlayModel.item().exif.EncodingProcess">
                      <td>Encoding&nbsp;process</td>
                      <td data-bind="text: nodeModel.overlayModel.item().exif.EncodingProcess()"></td>
                    </tr>
                  <!-- /ko -->
              </table>
            </div>

          </div>
          <div class="tab-pane" id="overlayTabEdit" data-bind="visible: nodeModel.node().hasAdminAccess()">

            <div style="margin: 0px 10px 10px 10px; font-size: 10px;">
              <div class="form-group">
                <button style="width: 100%" class="btn btn-danger btn-small" data-bind="click: nodeModel.overlayModel.remove">Remove</button>
              </div>
              <div class="form-group" data-bind="visible: nodeModel.overlayModel.item().exif && nodeModel.overlayModel.item().exif.MIMEType && (nodeModel.overlayModel.item().exif.MIMEType() === 'image/x-canon-cr2' || nodeModel.overlayModel.item().exif.MIMEType() === 'image/x-canon-crw')">
                <button style="width: 100%" class="btn btn-default btn-small" data-bind="click: nodeModel.overlayModel.hideRaw">Hide raw image</button>
              </div>
              <div class="form-group" data-bind="visible: nodeModel.overlayModel.item().whatDetailed() === 'videoFile'">
                <button style="width: 100%"  class="btn btn-default btn-small" data-bind="click: nodeModel.overlayModel.setThumbPosition">Set thumbnail position</button>
              </div>
              <div class="form-group">
                <div class="btn-group" data-bind="visible: nodeModel.overlayModel.item().whatDetailed() === 'videoFile' || nodeModel.overlayModel.item().whatDetailed() === 'imageFile'">
                  <button title="Rotate counter clockwise" style="width: 110px;" class="btn btn-default btn-small" data-bind="click: nodeModel.overlayModel.rotateLeft"><i class="icon-undo"></i></button>
                  <button title="Mirror" style="width: 111px;" class="btn btn-default btn-small" data-bind="disable: nodeModel.overlayModel.item().whatDetailed() === 'videoFile', click: nodeModel.overlayModel.mirror">Mirror</button>
                  <button title="Rotate clockwise" style="width: 110px;" class="btn btn-default btn-small" data-bind="click: nodeModel.overlayModel.rotateRight"><i class="icon-repeat"></i></button>
                </div>
              </div>
              <div class="form-group">
                <textarea class="form-control" placeholder="Description" data-bind="disable: nodeModel.overlayModel.editLoading, value: nodeModel.overlayModel.description"></textarea>
              </div>
              <div class="form-group">
                <button style="width: 100%;" class="btn btn-mini btn-primary" data-bind="disable: nodeModel.overlayModel.editLoading, click: nodeModel.overlayModel.descriptionSave">Save description</button>
              </div>
              <span class="text-danger" data-bind="visible: nodeModel.overlayModel.editErrorText() !== '', text: nodeModel.overlayModel.editErrorText"></span>
            </div>

          </div>

          <div class="tab-pane" id="overlayTabDownload" data-bind="visible: nodeModel.overlayModel.item().what() === 'file'">
            <div style="margin: 0px 10px 10px 10px;" data-bind="if: nodeModel.overlayModel.item().what() === 'file'">

              <table class="table table-condensed table-striped" style="font-size: 10px;">
                <tbody>
                  <tr>
                    <td>
                      <a href="#" data-bind="attr: { href: '/file?id=' +  nodeModel.overlayModel.item()._id() }"><i class="icon-file"></i> <span data-bind="text: nodeModel.overlayModel.item().name()"></span></a>
                    </td>
                    <td class="text-muted" data-bind="htmlSize: nodeModel.overlayModel.item().exif.FileSize()"></td>
                  </tr>

                  <!-- ko foreach: nodeModel.overlayModel.item().versions -->
                    <tr>
                      <td>
                        <a href="#" data-bind="attr: { href: '/file?id=' +  nodeModel.overlayModel.item()._id() + '&version=' + $data.id() }"><i class="icon-file-alt"></i> <span data-bind="text: $data.name"></span></a>
                      </td>
                      <td class="text-muted" data-bind="htmlSize: $data.size"></td>
                    </tr>
                  <!-- /ko -->
                </tbody>
              </table>

            </div>
          </div>
        </div>

      </div>
    </div>
  <!-- /ko -->
</div>

