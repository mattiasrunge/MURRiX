<div data-bind="fadeVisible: adminModel.show">
  <div class="abs-max content">
    <div class="page-header">
      <h1>Administration <small>Handle users and groups</small></h1>
    </div>

    <ul class="nav nav-tabs">
      <li data-bind="css: { active: adminModel.type() === 'groups' }">
        <a href="#" data-bind="hrefFirstSecondary: 'groups'">Groups</a>
      </li>
      <li data-bind="css: { active: adminModel.type() === 'users' }">
        <a href="#" data-bind="hrefFirstSecondary: 'users'">Users</a>
      </li>
      <li class="pull-right">
        <a href="#" data-bind="click: adminModel.createHandle"><i class="icon-plus"></i></a>
      </li>
    </ul>


    <div style="margin-bottom: 50px; margin-top: 20px;" data-bind="visible: adminModel.type() === 'groups'">

      <!-- ko foreach: adminModel.groups -->

        <div class="panel">
          <div class="panel-heading">
            <form class="pull-right">
              <input placeholder="Add user..." class="form-control input-small" type="text" style="width: 150px" data-bind="typeahead: { data: $data , items: 10, source: $root.adminModel.groupTypeaheadSource, matcher: $root.adminModel.groupTypeaheadMatcher, highlighter: $root.adminModel.groupTypeaheadHighlighter, updater: $root.adminModel.groupTypeaheadUpdater }" data-provide="typeahead"/>
            </form>

            <h3 class="panel-title" style="line-height: 28px;">
              <i class="icon-group"></i>
              <span data-bind="text: $data.name"></span>

              <a title="Edit" class="" href="#" data-bind="click: adminModel.groupEditClicked">
                <i class="icon-cog"></i>
              </a>
              <a title="Remove" class="" href="#" data-bind="click: adminModel.groupRemoveClicked">
                <i class="icon-trash"></i>
              </a>
            </h3>

          </div>
          <p class="text-muted" data-bind="text: $data.description"></p>

          <div data-bind="foreach: adminModel.groupUsers($data)" class="clearfix" style="margin-bottom: -5px;">
            <span class="label label-info pull-left" style="margin-right: 5px; margin-bottom: 5px; font-size: 16px;">
              <i class="icon-user"></i>
              <span data-bind="text: $data.name"></span>
              <i style="cursor: pointer;" title="Remove user from group" data-bind="click: adminModel.groupRemoveUserHandler.bind($data, $parent)" class="icon-remove"></i>
            </span>
          </div>

        </div>

      <!-- /ko -->
    </div>

    <div style="margin-bottom: 50px; margin-top: 20px;" data-bind="visible: adminModel.type() === 'users'">

       <!-- ko foreach: adminModel.users -->
        <div class="panel" data-bind="css: { 'panel-danger': $data.admin }">
          <div class="panel-heading">
            <form class="pull-right">
              <input placeholder="Add group..." class="form-control input-small" type="text" style="width: 150px" data-bind="typeahead: { data: $data , items: 10, source: $root.adminModel.userTypeaheadSource, matcher: $root.adminModel.userTypeaheadMatcher, highlighter: $root.adminModel.userTypeaheadHighlighter, updater: $root.adminModel.userTypeaheadUpdater }" data-provide="typeahead"/>
            </form>

            <h3 class="panel-title" style="line-height: 28px;">
              <i class="icon-user"></i>
              <span data-bind="text: $data.name"></span>

              <a title="Edit" href="#" data-bind="click: adminModel.userEditClicked">
                <i class="icon-cog"></i>
              </a>
              <a title="Remove" href="#" data-bind="click: adminModel.userRemoveClicked">
                <i class="icon-trash"></i>
              </a>
              <a title="Change password" href="#" data-bind="click: adminModel.userPasswordClicked">
                <i class="icon-key"></i>
              </a>
            </h3>

          </div>

          <img class="img-thumbnail pull-left" src="" style="width: 125px; height: 125px; margin-right: 15px; margin-bottom: 5px;" data-bind="srcUserProfilePicture: [ $data._id, 250, 250, 1 ]">

          <div data-bind="foreach: $data._groups" class="clearfix" style="margin-bottom: -5px;">
            <span class="label label-info pull-left" style="margin-right: 5px; margin-bottom: 5px; font-size: 16px;">
              <i class="icon-group"></i>
              <span data-bind="textGroupAttribute: [ $data, 'name' ]"></span>
              <i style="cursor: pointer;" title="Remove group from user" data-bind="click: adminModel.userRemoveGroupHandler.bind($data, $parent)" class="icon-remove"></i>
            </span>
          </div>

          <div class="panel-footer">
           <span data-bind="visible: !$data.lastLogin()">User has never logged in.</span>
           <span data-bind="visible: $data.lastLogin()">User logged in <span data-bind="htmlTimeAgo: $data.lastLogin()"></span>.</span>
          </div>

        </div>

      <!-- /ko -->
    </div>

  </div>
  <div class="abs-max background"></div>
</div>
